import { ethers } from "hardhat";
import { expect } from "chai";

import type { SignerWithAddress } from "@nomiclabs/hardhat-ethers/signers";
import type { ContractFactory } from "ethers";
import type { ISetup, Exploit34 } from "../typechain-types";
import { ISetup__factory } from "../typechain-types";

const { parseUnits } = ethers.utils;

import * as ForkHelpers from "./shared/forkHelpers";

describe("", () => {
  let owner: SignerWithAddress;
  let alice: SignerWithAddress;
  let bob: SignerWithAddress;

  const setupAddr = "0xB1F9187d9FFCd22fE2c26FeF3E8b8F90C31Ae885";
  const challengeAddr = "0xc0E7beD54707b176A540C0b30bCB50c86e55b553";

  let setup: ISetup;
  let Exploit: ContractFactory;
  let exploit: Exploit34;

  beforeEach(async () => {
    await ForkHelpers.forkToGoerli(6385078);

    [owner, alice, bob] = await ethers.getSigners();

    Exploit = await ethers.getContractFactory("Exploit34");

    setup = ISetup__factory.connect(setupAddr, owner);
  });

  it("works", async () => {
    const exploit = await Exploit.deploy(challengeAddr);
    await exploit.finalize({ value: parseUnits("1") });

    expect(await setup.isSolved()).to.be.true;
  });
});
